<!DOCTYPE html>
<html lang="en" class="dark">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>OtakuOasis - Stream Anime</title>
<script src="https://cdn.tailwindcss.com"></script>
<script>tailwind.config={darkMode:'class'}</script>
</head>
<body class="bg-gray-900 text-white font-sans">

<!-- Navbar -->
<header class="sticky top-0 bg-gray-950 shadow-lg z-50 p-4 flex justify-between items-center">
  <h1 class="text-2xl font-bold text-purple-400"><a href="index.html">OtakuOasis</a></h1>
  <div class="flex items-center gap-4">
    <input type="text" id="searchInput" placeholder="Search anime..." class="px-3 py-2 rounded-lg text-gray-900 focus:outline-none">
    <button onclick="openAuthModal()" class="px-3 py-2 bg-purple-500 rounded-lg hover:bg-purple-600 transition">Login / Sign Up</button>
    <button id="themeToggle" class="px-3 py-2 bg-gray-700 rounded-lg hover:bg-gray-600 transition">🌙</button>
  </div>
</header>

<!-- Hero Slider / Banner -->
<section id="heroSection" class="relative max-w-7xl mx-auto my-6 overflow-hidden rounded-xl">
  <div id="heroCarousel" class="flex gap-4 overflow-x-auto pb-4"></div>
</section>

<!-- Trending Anime -->
<section id="trendingSection" class="max-w-7xl mx-auto p-4">
  <h2 class="text-2xl font-bold text-purple-400 mb-4">🔥 Trending Anime</h2>
  <div id="trendingGrid" class="grid grid-cols-2 sm:grid-cols-3 md:grid-cols-4 lg:grid-cols-5 gap-4"></div>
</section>

<!-- Popular Anime -->
<section id="popularSection" class="max-w-7xl mx-auto p-4">
  <h2 class="text-2xl font-bold text-purple-400 mb-4">⭐ Popular Anime</h2>
  <div id="popularGrid" class="grid grid-cols-2 sm:grid-cols-3 md:grid-cols-4 lg:grid-cols-5 gap-4"></div>
</section>

<!-- Latest Anime -->
<section id="latestSection" class="max-w-7xl mx-auto p-4">
  <h2 class="text-2xl font-bold text-purple-400 mb-4">🆕 Latest Anime</h2>
  <div id="latestGrid" class="grid grid-cols-2 sm:grid-cols-3 md:grid-cols-4 lg:grid-cols-5 gap-4"></div>
</section>

<!-- Footer -->
<footer class="bg-gray-950 py-6 text-center text-gray-400">
  © <span id="year"></span> OtakuOasis
</footer>

<!-- Auth Modal -->
<div id="authModal" class="fixed inset-0 bg-black bg-opacity-70 hidden items-center justify-center z-50">
  <div class="bg-gray-800 p-6 rounded-2xl w-96 max-w-full relative">
    <button id="closeModal" class="absolute top-3 right-3 text-gray-400 hover:text-white">✕</button>

    <div id="loginFormContainer">
      <h2 class="text-2xl font-bold text-purple-400 mb-4 text-center">Login</h2>
      <form id="loginForm" class="space-y-4">
        <input type="email" id="loginEmail" placeholder="Email" required class="w-full px-3 py-2 rounded-lg bg-gray-700 text-white focus:outline-none focus:ring-2 focus:ring-purple-500">
        <input type="password" id="loginPassword" placeholder="Password" required class="w-full px-3 py-2 rounded-lg bg-gray-700 text-white focus:outline-none focus:ring-2 focus:ring-purple-500">
        <button type="submit" class="w-full bg-purple-500 hover:bg-purple-600 px-4 py-2 rounded-lg font-semibold transition">Log In</button>
      </form>
      <p class="text-gray-400 mt-4 text-center text-sm">Don't have an account? <span id="showSignup" class="text-purple-400 cursor-pointer hover:underline">Sign up</span></p>
    </div>

    <div id="signupFormContainer" class="hidden">
      <h2 class="text-2xl font-bold text-purple-400 mb-4 text-center">Sign Up</h2>
      <form id="signupForm" class="space-y-4">
        <input type="text" id="signupUsername" placeholder="Username" required class="w-full px-3 py-2 rounded-lg bg-gray-700 text-white focus:outline-none focus:ring-2 focus:ring-purple-500">
        <input type="email" id="signupEmail" placeholder="Email" required class="w-full px-3 py-2 rounded-lg bg-gray-700 text-white focus:outline-none focus:ring-2 focus:ring-purple-500">
        <input type="password" id="signupPassword" placeholder="Password" required class="w-full px-3 py-2 rounded-lg bg-gray-700 text-white focus:outline-none focus:ring-2 focus:ring-purple-500">
        <button type="submit" class="w-full bg-purple-500 hover:bg-purple-600 px-4 py-2 rounded-lg font-semibold transition">Sign Up</button>
      </form>
      <p class="text-gray-400 mt-4 text-center text-sm">Already have an account? <span id="showLogin" class="text-purple-400 cursor-pointer hover:underline">Log in</span></p>
    </div>

    <p id="authMessage" class="text-center mt-4 text-sm"></p>
  </div>
</div>

<script>
const API_BASE="https://animegurui-otakuoasis.onrender.com/api";
document.getElementById("year").textContent = new Date().getFullYear();

// Dark mode
const themeToggle=document.getElementById("themeToggle");
const userTheme=localStorage.getItem("theme");
if(userTheme==="dark"||!userTheme){document.documentElement.classList.add("dark"); themeToggle.textContent="🌙";}
else{document.documentElement.classList.remove("dark"); themeToggle.textContent="☀️";}
themeToggle.addEventListener("click",()=>{
  document.documentElement.classList.toggle("dark");
  const isDark=document.documentElement.classList.contains("dark");
  localStorage.setItem("theme",isDark?"dark":"light");
  themeToggle.textContent=isDark?"🌙":"☀️";
});

// Fetch anime list
async function fetchAnime(endpoint, gridId){
  const grid=document.getElementById(gridId);
  grid.innerHTML="<p class='col-span-full text-gray-400 text-center'>Loading...</p>";
  try{
    const res=await fetch(`${API_BASE}/${endpoint}`);
    if(!res.ok) throw new Error();
    const list=await res.json();
    grid.innerHTML="";
    if(!list.length){grid.innerHTML="<p class='col-span-full text-gray-400 text-center'>No anime found.</p>"; return;}
    list.forEach(a=>{
      const card=document.createElement("div");
      card.className="bg-gray-800 rounded-lg overflow-hidden shadow hover:scale-105 transition cursor-pointer";
      card.innerHTML=`<img src="${a.image||'https://via.placeholder.com/300x450?text=?'}" alt="${a.title}" class="w-full h-48 object-cover"><div class="p-2"><h3 class="font-semibold text-sm truncate">${a.title}</h3></div>`;
      card.addEventListener("click",()=>window.location.href=`anime.html?id=${a._id||a.id}`);
      grid.appendChild(card);
    });
  }catch(err){
    grid.innerHTML="<p class='col-span-full text-red-400 text-center'>Failed to load anime.</p>";
    console.error(err);
  }
}

// Load hero, trending, popular, latest
fetchAnime("anime/trending","heroCarousel");
fetchAnime("anime/trending","trendingGrid");
fetchAnime("anime/popular","popularGrid");
fetchAnime("anime/latest","latestGrid");

// Search
const searchInput=document.getElementById("searchInput");
searchInput.addEventListener("keypress",e=>{
  if(e.key==="Enter" && searchInput.value.trim()){
    window.location.href=`anime.html?search=${encodeURIComponent(searchInput.value.trim())}`;
  }
});

// Auth modal
const authModal=document.getElementById("authModal");
const closeModal=document.getElementById("closeModal");
const loginFormContainer=document.getElementById("loginFormContainer");
const signupFormContainer=document.getElementById("signupFormContainer");
const showSignup=document.getElementById("showSignup");
const showLogin=document.getElementById("showLogin");
const authMessage=document.getElementById("authMessage");
function openAuthModal(){authModal.classList.remove("hidden");}
closeModal.addEventListener("click",()=>authModal.classList.add("hidden"));
showSignup.addEventListener("click",()=>{loginFormContainer.classList.add("hidden"); signupFormContainer.classList.remove("hidden"); authMessage.textContent="";});
showLogin.addEventListener("click",()=>{signupFormContainer.classList.add("hidden"); loginFormContainer.classList.remove("hidden"); authMessage.textContent="";});

// Login
document.getElementById("loginForm").addEventListener("submit", async e=>{
  e.preventDefault();
  authMessage.textContent="Logging in..."; authMessage.className="text-center mt-4 text-gray-400";
  try{
    const res=await fetch(`${API_BASE}/auth/login`,{
      method:"POST",
      headers:{"Content-Type":"application/json"},
      body:JSON.stringify({email:document.getElementById("loginEmail").value,password:document.getElementById("loginPassword").value})
    });
    const data=await res.json();
    if(!res.ok) throw new Error(data.message||"Login failed");
    localStorage.setItem("token",data.token);
    authMessage.textContent="✅ Login successful!"; authMessage.className="text-center mt-4 text-green-400";
    setTimeout(()=>authModal.classList.add("hidden"),1000);
  }catch(err){authMessage.textContent="❌ "+err.message; authMessage.className="text-center mt-4 text-red-400";}
});

// Signup
document.getElementById("signupForm").addEventListener("submit", async e=>{
  e.preventDefault();
  authMessage.textContent="Creating account..."; authMessage.className="text-center mt-4 text-gray-400";
  try{
    const res=await fetch(`${API_BASE}/auth/register`,{
      method:"POST",
      headers:{"Content-Type":"application/json"},
      body:JSON.stringify({
        username:document.getElementById("signupUsername").value,
        email:document.getElementById("signupEmail").value,
        password:document.getElementById("signupPassword").value
      })
    });
    const data=await res.json();
    if(!res.ok) throw new Error(data.message||"Signup failed");
    authMessage.textContent="✅ Account created!"; authMessage.className="text-center mt-4 text-green-400";
    setTimeout(()=>{signupFormContainer.classList.add("hidden"); loginFormContainer.classList.remove("hidden"); authMessage.textContent="";},1500);
  }catch(err){authMessage.textContent="❌ "+err.message; authMessage.className="text-center mt-4 text-red-400";}
});
</script>

</body>
</html>
